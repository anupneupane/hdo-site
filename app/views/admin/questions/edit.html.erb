<h3>
  Spørsmål
  <small class="pull-right <%= alert_class_for_status(@question.status) %>"><%= @question.status_text %></small>
</h3>

<%= form_for(@question, url: admin_question_url(@question)) do |f| %>
  <div class="form-actions">
    <%= f.submit t('app.save'), class: 'btn btn-primary' %>
    <%= link_to t('app.back'), admin_questions_path, class: 'btn' %>
  </div>

  <div class="row-fluid">
    <dl class="span6">
      <dt><%= Question.human_attribute_name :created_at %></dt>
      <dd><%= l @question.created_at.localtime %></dd>

      <dt><%= Question.human_attribute_name :representative %></dt>
      <dd><%= link_to @question.representative.name, @question.representative %></dd>

      <dt><%= Question.human_attribute_name :from_name %></dt>
      <dd><%= f.text_field :from_name %></dd>

      <dt><%= Question.human_attribute_name :from_email %></dt>
      <dd><%= @question.from_email %></dd>

      <dt><%= Question.human_attribute_name :show_sender %> <%= f.check_box :show_sender %></dt>

      <dt><%= Question.human_attribute_name :body %></dt>
      <dd class="well">
        <%= f.text_area :body, rows: 5, style: 'width: 100%;' %>
        <small class="muted">Suπerforsiktig, superadmin...</small>
      </dd>

      <dt><%= Question.human_attribute_name :internal_comment %></dt>
      <dd><%= f.text_area :internal_comment, rows:  5, style: 'width: 100%' %></dd>
    </dl>

    <dl class="span6">
      <dt><%= Question.human_attribute_name :status %></dt>
      <dd><%= f.select :status, question_status_options %></dd>

      <dt><%= Question.human_attribute_name :issues %></dt>
      <dd><%= f.select :issues, question_issue_options, {}, multiple: true, data: {placeholder: 'Velg saker'} %></dd>
    </dl>
  </div>

  <hr class="soften">

  <div class="row-fluid">
    <h3>
      Svar

      <% if @answer %>
        <small>fra <%= @answer.representative.full_name %></small>
        <small class="pull-right <%= alert_class_for_status(@answer.status) %>"><%= @answer.status_text %></small>
      <% end %>
    </h3>

    <div class="row-fluid">
      <% if @answer.nil? %>
        Ingen svar foreløπig.
      <% else %>
        <dl class="span6">
          <dt><%= Answer.human_attribute_name :created_at %></dt>
          <dd><%= l @answer.created_at.localtime %></dd>

          <dt><%= Answer.human_attribute_name :body %></dt>
          <dd class="well">
            <%= f.text_area :answer_body, rows: 5, style: 'width: 100%;' %>
            <small class="muted">Suπerforsiktig, superadmin...</small>
          </dd>
        </dl>

        <dl class="span6">
          <dt><%= Question.human_attribute_name :status %></dt>
          <dd><%= select_tag 'question[answer][status]', answer_status_options %></dd>
        </dl>
      <% end %>
    </div>

    <hr class="soften">

  <h3>E-poster</h3>
  <div class="row-fluid">
    <div class="span4<%= @question.approved? ? '' : ' muted' %>">
      <h4>Ved godkjent spørsmål</h4>
      <% if @question.approved? %>
        <div class="row-fluid">
          <%= link_to 'Send e-post til bruker', question_approved_email_user_admin_question_path(@question), class: 'btn', confirm: 'Er du sikker på at du vil sende e-post til brukeren?' %>
        </div>
        <div class="row-fluid">
          <%= link_to 'Send e-post til representant', question_approved_email_rep_admin_question_path(@question), class: 'btn', confirm: 'Er du sikker på at du vil sende e-post til representanten?'%>
        </div>
      <% else %>
        <div class="row-fluid"><div class="btn disabled">Send e-post til bruker</div></div>
        <div class="row-fluid"><div class="btn disabled">Send e-post til representant</div></div>
      <% end %>
    </div>
    <div class="span4<%= @question.rejected? ? '' : ' muted' %>">
      <h4>Ved avvist spørsmål</h4>
      <% if @question.rejected? %>
        <div class="row-fluid">
          <a href="#" data-toggle="modal" data-target="#reject-question-email-modal" class="btn">Send e-post til bruker</a>
        </div>
      <% else %>
        <div class="row-fluid"><div class="btn disabled">Send e-post til bruker</div></div>
      <% end %>
    </div>
    <div class="span4<%= @question.answer && @question.answer.approved? ? '' : ' muted' %>">
      <h4>Ved godkjent svar</h4>
      <% if @question.has_approved_answer? %>
        <div class="row-fluid">
          <%= link_to 'Send e-post til bruker', answer_approved_email_user_admin_question_path(@question), class: 'btn', confirm: 'Er du sikker på at du vil sende e-post til brukeren?' %>
        </div>
      <% else %>
        <div class="row-fluid"><div class="btn disabled">Send e-post til bruker</div></div>
      <% end %>
    </div>
  </div>

  <% if @question.email_events.any? %>
      <h4>Sendte e-poster</h4>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Sendt</th>
            <th>Til</th>
            <th>Emne</th>
          </tr>
        </thead>

        <tbody>
          <% @question.email_events.each do |email_event| %>
            <tr>
              <td><%= l email_event.created_at %></td>
              <td><%= email_event.email_address %></td>
              <td><%= email_event.email_type %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
  <% end %>

  <div class="form-actions">
    <%= f.submit t('app.save'), class: 'btn btn-primary' %>
    <%= link_to t('app.back'), admin_questions_path, class: 'btn' %>
  </div>
<% end %>

<div id="reject-question-email-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
  <%= form_tag(question_rejected_email_user_admin_question_path(@question)) do %>
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3>Avvis spørsmål</h3>
    </div>

    <div class="modal-body">
      <!-- <h5>Avvisningsgrunn</h5> -->
      <h2>Kjære <%= @question.from_name %></h2>

      <p>Takk for ditt spørsmål!</p>

      <p>Formålet med tjenesten spør en stortingspolitiker er å tilby velgere og folkevalgte en kanal for saklig meningsbryting om politikk. Tjenesten modereres av Holder de ord i henhold til våre retningslinjer. Der står det bl.a. følgende:</p>

      <p><%= text_area_tag :reason,
                        '"Du må oppgi fullt navn og gyldig epostadresse når du stiller spørsmål. Disse vil ikke bli videreformidlet til utenforstående. Du bestemmer selv i den publiserte saken om du ønsker å opptre med fullt navn eller kun med initialer."',
                        style: 'width: 30em; height: 7em;' %></p>

      <p>Holder de ord har vurdert det slik at ditt spørsmål i dets nåværende form ikke tilfredsstiller dette, og kan dessverre ikke godkjenne det.  Hvis du ønsker å omformulere og sende inn spørsmålet på nytt, tar vi gjerne imot det! Det er da bare å sende det som svar på denne mailen.</p>

      <p>Ditt spørsmål: <br/><em><%= @question.body %></em></p>

      <p>Ha en god dag!</p>

      <p style="color:#666">Vennlig hilsen,<br/>
        Holder de ord</p>

      <p style="font-size: small; color: #666;">Hvis det ikke er du som har sendt inn dette spørsmålet, si gjerne fra ved å svare på denne mailen.</p>
    </div>

    <div class="modal-footer">
       <button class="btn" data-dismiss="modal" aria-hidden="true">Avbryt</button>
       <%= submit_tag 'Send', class: 'btn btn-primary' %>
       <%#= link_to 'Send', question_rejected_email_user_admin_question_path(@question), class: 'btn btn-primary', confirm: 'Er du sikker på at du vil sende e-post til brukeren?' %>
     </div>
  <% end %>
</div>

<% content_for :document_ready do %>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
      $("#question_issues").chosen();
    });
  </script>
<% end %>
