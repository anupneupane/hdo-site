<% page_title "#{@representative.full_name} - #{Representative.model_name.human(count: 2).capitalize} - #{t('app.title')}" %>
<% party = @representative.latest_party %>

<div class="representative-profile">

  <%= image_tag @representative.image.versions[:medium], width: '240', height: '320', class: 'representative-image', alt: @representative.full_name %>

  <h1 class="representative-name"><%= @representative.full_name %> (<%= @representative.age %>)</h1>

  <aside>
    <span class="representative-district">
    <%= link_to @representative.district.name, @representative.district %>
    </span>
    <span class="representative-party">
      <%= party && link_to(party.name, party, class:party.external_id) %>
    </span>
    <dl class="representative-comitee-list">
      <% @representative.current_committees.each do |com| %>
        <dd>Medlem av <%= link_to com.name, com %></dd>
      <% end %>
    </dl>
  </aside>

</div>

<hr class="soften">

<% if @representative.twitter_id.present? %>

  <h3>Twitter <a href="http://twitter.com/<%= @representative.twitter_id %>" class="muted">(@<%= @representative.twitter_id %>)</a></h3>
  <div id="representative-tweets">
    <span class="muted">Henter kvitter...</span>
  </div>

  <hr>

  <% content_for :document_ready do %>
  <script>
    $(function() {
      if ("<%= @representative.twitter_id %>" == "") {
        var notweets = "<span class='muted'>Ingen twitterkonto registrert for <%= @representative.full_name %>.</span>";
        $('#representative-tweets').html(notweets);
      }

      else {
        var req = $.ajax({
          url: "http://search.twitter.com/search.json?q=from%3A<%= @representative.twitter_id %>&callback=?",
          dataType: "jsonp",
          timeout: 5000
        });

        req.success(function (data) {
          var tweets = "<div class='row-fluid'>"
          $(data.results).each(function(index) {
            if (index < 6) {
              var tweet = this;
              tweets += "<article class='span4'>" + tweet.text + "</article>";
              if ((index+2) % 3 == 1) {
                tweets += "</div><div class='row-fluid'>"
              }
            }
          });
          tweets += "</div>";
          $('#representative-tweets').html(tweets);
        });

        req.error(function (data) {
          var notweets = "<span class='muted'>Fikk ikke kontakt med Twitter. Fugl fl√∏yet.</span>";
          $('#representative-tweets').html(notweets);
        });

      }
    });
  </script>
  <% end %>
<% end %>


<h3>Posisjoner</h3>
<!--
  TODO:
   * SPLIT IN FOR AGAINST, EACH IN A SPAN6 UL INSIDE A ROW-FLUID
   * FIX LANGUAGE (FOR/MOT)
   * MAKE THE LINK CONTAIN THE SPAN, INFINITIVE_PARTICLE AND PERIOD.
-->
<div class="row-fluid">
  <% [:for, :for_and_against, :against].each do |key| %>
    <ul class="representative-issue-list span4">
      <% Array(@issue_groups[key]).each do |issue| %>
        <li>
          <%= link_to issue do %>
            <span class="issue-<%= key %>"><%= t "app.#{key}" %></span>
            <%= t 'app.lang.infinitive_particle' %>
            <%= issue.downcased_title %>.
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>

